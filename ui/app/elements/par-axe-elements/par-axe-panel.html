

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="par-axe-panel">
  <template>

    <style include="shared-styles"></style>
    
    <style>
    :host {
      display: block;
    }

    #backFab {
      position: fixed;
      z-index: 100;
      
    }

    .content {
      max-width: 800px; 
      margin-left: auto; 
      margin-right: auto;
    }

    paper-card {
      width: 100%;
    }


    </style>

    <paper-fab id="backFab" icon="icons:arrow-back" on-tap="_backTap"></paper-fab>

    <div class="content">

      <paper-card heading="{{axe.intitule}}">
        <form is="iron-form" id="axeForm">

          <div class="card-content">
            <paper-input name="num" type="number" label="Numéro" min="1" required auto-validate value="{{_dirty.num}}"></paper-input>
            <paper-input name="intitule" label="Intitulé" required char-counter maxlength="250" auto-validate value="{{_dirty.intitule}}"></paper-input>
          </div>

          <div class="card-actions layout horizontal">
            <div class="flex"></div>
            <template is="dom-if" if="{{!_dirty._id}}">
              <paper-button raised on-tap="_createTap">Créer</paper-button>
            </template>
            <template is="dom-if" if="{{_dirty._id}}">
              <paper-button raised on-tap="_updateTap">Modifier</paper-button>
            </template>
            <paper-button on-tap="_cancelTap">Annuler</paper-button>
          </div>

        </form>
      </paper-card>

    </div>

    <paper-toast id="toast"></paper-toast>

  </template>


  <script>
  (function() {
    'use strict';

    var cloneAxe = function(axe) {
      var dirty;
      if (axe) {
        dirty = {};
        for (var attr in axe) {
          if (axe.hasOwnProperty(attr)) {
            dirty[attr] = axe[attr];
          }
        }
        
      } else {
        dirty = null;
      }

      return dirty;
    };

    Polymer({
      is: 'par-axe-panel',

      properties: {
        axe: {
          type: Object,
          notify: true,
          observer: '_axeChanged'
        }

      },

      _axeChanged: function(axe) {
        this._dirty = cloneAxe(axe);
      },

      _backTap: function() {
        this._dirty = null;
        this.fire('back');
      },

      _cancelTap: function() {
        this._dirty = null;
        this.fire('cancel');
      },

      _createTap: function() {
        if (this.$.axeForm.validate()) {
          this.axe = this._dirty;
          this.fire('create', {axe: this.axe});
        } else {
          this.$.toast.text = 'Création l\'axe refusée.';
          this.$.toast.text += ' Le formulaire comporte des données invalides';
          this.$.toast.open();
        }
      },

      _updateTap: function() {
        if (this.$.axeForm.validate()) {
          this.axe = this._dirty;
          this.fire('update', {axe: this.axe});
        } else {
          this.$.toast.text = 'Modification de l\'axe refusée.';
          this.$.toast.text += ' Le formulaire comporte des données invalides.';
          this.$.toast.open();
        }
      }

    });
  })();
  </script>
</dom-module>
