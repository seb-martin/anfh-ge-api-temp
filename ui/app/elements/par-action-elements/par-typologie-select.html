<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="par-typologie-select">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
      }

      paper-dropdown-menu {
        width:100%        
      }
    </style>

    <paper-dropdown-menu id="dropdown" label="[[label]]" required="[[required]]">
      <paper-listbox class="dropdown-content" selected="{{_selected}}">
        <template is="dom-repeat" items="[[_typos]]" as="_typo">
          <paper-item>[[_typo.libelle]]</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'par-typologie-select',

        behaviors: [
          Polymer.IronFormElementBehavior,
          Polymer.IronValidatableBehavior
        ],

        properties: {
          label: {
            type: String,
            value: 'Typologie'
          },
          value: {
            type: String,
            notify: true,
            observer: '_valueChanged'
          },
          autoValidate: {
            type: Boolean
          },

          _selected: {
            type: Number,
            observer: '_selectedChanged'
          }
        },

        ready: function() {
          this._typos = [
            {
              code: '1', 
              libelle: 'Formation professionnelle initiale'
            },
            {
              code: '2', 
              libelle: 'Formation continue ou Développement des connaissances et des compétences'
            },
            {
              code: '3', 
              libelle: 'Préparation concours et examens'
            },
            {
              code: '5', 
              libelle: 'Action de conversion'
            }
          ];
        },

        _valueChanged: function(typo) {
          var idx = -1;
          var i = 0;

          if (typo) {

            for (i ; i < this._typos.length ; i++) {
              if (this._typo[i].code === typo) {
                idx = i;
                break;
              }
            }

            if (idx !== this._selected) {
              this._selected = idx;
            }
          } else {
            this._selected = null;
          }

          if (this.autoValidate) {
            this.async(function() {
              this.$.dropdown.validate(typo);
            });
          }
          
        },

        _selectedChanged: function(index) {
          if (typeof index === 'number' && index >= 0) {
            if (this._typos[index].code !== this.value) {
              this.value = this._typos[index].code;
            }
          } else {
            this.value = null;
          }
        }

      });
    })();
  </script>

</dom-module>
