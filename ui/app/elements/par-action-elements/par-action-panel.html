

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="par-action-panel">
  <template>

    <style include="shared-styles"></style>
    
    <style>
    :host {
      display: block;
    }

    paper-fab#backFab {
      position: fixed;
      z-index: 100;
      
    }

    .content {
      max-width: 800px; 
      margin-left: auto; 
      margin-right: auto;
    }

    paper-card {
      width: 100%;
    }


    </style>

    <paper-fab id="backFab" icon="icons:arrow-back" on-tap="_backTap"></paper-fab>

    <div class="content">

      <paper-card heading="{{action.intitule}}">
        <form is="iron-form" id="actionForm">

          <div class="card-content layout vertical">
            <paper-input name="intitule" label="Intitulé" required char-counter maxlength="250" auto-validate value="{{_dirty.intitule}}"></paper-input>

            <par-axe-select label="Axe" axes="[[axes]]" value="{{_dirty.axe}}"></par-axe-select>

            <par-nature-select label="Nature" value="{{_dirty.nature}}" default="R" required></par-nature-select>

            <par-typologie-select label="Typologie FPTLV" value="{{_dirty.typologie}}" required></par-typologie-select>

            <par-marked-textarea label="Contexte" value="{{_dirty.contexte}}"></par-marked-textarea>

            <par-marked-textarea label="Objectifs" value="{{_dirty.objectifs}}"></par-marked-textarea>

            <par-marked-textarea label="Programme" value="{{_dirty.programme}}"></par-marked-textarea>
          </div>

          <div class="card-actions layout horizontal">
            <div class="flex"></div>
            <template is="dom-if" if="{{!_dirty._id}}">
              <paper-button on-tap="_createTap">Créer</paper-button>
            </template>
            <template is="dom-if" if="{{_dirty._id}}">
              <paper-button on-tap="_updateTap">Modifier</paper-button>
            </template>
            <paper-button on-tap="_cancelTap">Annuler</paper-button>
          </div>

        </form>
      </paper-card>

    </div>

  </template>


  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'par-action-panel',

      properties: {
        action: {
          type: Object,
          notify: true,
          observer: '_actionChanged'
        },

        axes: {
          type: Array
        }

      },

      created: function() {
      },

      ready: function() {
      },

      _actionChanged: function(action) {
        
        var dirty;
        if (action) {
          dirty = {};
          for (var attr in action) {
            if (this.action.hasOwnProperty(attr)) {
              dirty[attr] = action[attr];
            }
          }
          
        } else {
          dirty = null;
        }

        this._dirty = dirty;

      },

      _backTap: function(/* e */) {
        var self = this;
        this._dirty = null;
        this.async(function() {
          self.fire('back');
        });
      },

      _cancelTap: function(/* e */) {
        var self = this;
        this._dirty = null;
        this.async(function() {
          self.fire('cancel');
        });
      },

      _createTap: function() {
        var self = this;
        if (this.$.actionForm.validate()) {
          this.action = this._dirty;
          this.async(function() {
            self.fire('create');
          });
        }
      },

      _updateTap: function() {
        var self = this;
        if (this.$.actionForm.validate()) {
          this.action = this._dirty;
          this.async(function() {
            self.fire('update');
          });
        }
      }

    });
  })();
  </script>
</dom-module>
